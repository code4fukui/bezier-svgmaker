<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:">
<title>bezier1</title>

<script type="module">

/*
小文字で相対位置

M x y  指定した点(x,y)へ移動のみを行う。
Z  現在点から開始点まで直線を引く。
L x y  現在点から指定された座標まで直線を引く。
H x y  現在点から指定された座標まで水平線を引く。
V x y  現在点から指定された座標まで垂直線を引く。
Q x1 y1 x y  現在点から指定された座標 (x,y) まで2次ベジェ曲線を引く。(x1,y1) は、開始点と終点の制御点を指す。
T x y  現在点から指定された座標 (x,y) まで2次ベジェ曲線を引く。
A rx ry x-axis-rotation large-arc-flag sweep-flag x y  現在の点から指定された座標 (x,y) まで楕円形の曲線を引く。楕円は2つの半径 (rx,ry) と軸の回転 (x-axis-rotation) によって定義される。large-arc-flagとsweep-flagは楕円の描き方を指す。
C x1 y1 x2 y2 x y  現在点から指定された座標 (x,y) まで3次ベジェ曲線を引く。(x1,y1) は曲線の開始点の制御点で、(x2,y2) は曲線の終点の制御点を示す。
S x1 y1 x y  現在点から指定された座標 (x,y) まで3次ベジェ曲線を引く。開始点の制御点は、直前に引かれた曲線の終点を指し、(x1,y1) は終点の制御点を示す。

*/

const createSVG = (tag) => {
  return document.createElementNS("http://www.w3.org/2000/svg", "svg:" + tag);
};

let r = 8;
let cp; // control points
let bez;
let line;

onload = function() {
  const svg = createSVG("svg");
  svg.id = "svg";
  svg.setAttribute("width", "500");
  svg.setAttribute("height", "500");
  
  const p = [ 100, 400, 100, 100, 400, 100, 400, 400 ];
  
  cp = [];
  for (let i = 0; i < 4; i++) {
    const c = createSVG("circle");
    c.setX = function(x) {
      this.posx = x;
      this.setAttribute("cx", x);
    };
    c.getX = function() {
      return this.posx;
    }
    c.setY = function(y) {
      this.posy = y;
      this.setAttribute("cy", y);
    };
    c.getY = function() {
      return this.posy;
    }
    c.contains = function(px, py) {
      const dx = this.posx - px;
      const dy = this.posy - py;
      return dx * dx + dy * dy < r * r;
    };
    c.setX(p[i * 2]);
    c.setY(p[i * 2 + 1]);
    c.setAttribute("r", r);
    c.setAttribute("fill", "none");
    c.setAttribute("stroke", "#000000");
    svg.appendChild(c);
    cp.push(c);
  }
  
  svg.onmousedown = function(e) {
    const mx = e.offsetX;
    const my = e.offsetY;
//    $("debug").textContent = mx + "x" + my + " click";
    const c = getHit(cp, mx, my);
    if (c != null) {
      this.current = c;
      this.orgx = c.getX();
      this.orgy = c.getY();
      this.mdx = mx;
      this.mdy = my;
    }
  };
  svg.onmousemove = function(e) {
    const mx = e.offsetX;
    const my = e.offsetY;
//    $("debug").textContent = e.x + "x" + e.y;
    if (this.current == null) {
      const c = getHit(cp, mx, my);
      svg.style.cursor = c != null ? "pointer" : "default";
    } else {
      const dx = mx - this.mdx;
      const dy = my - this.mdy;
      this.current.setX(this.orgx + dx);
      this.current.setY(this.orgy + dy);
      bez.draw();
    }
  };
  svg.onmouseup = function(e) {
    if (this.current != null) {
      this.current = null;
    }
  };
  
  const b = createSVG("path");
//  b.setAttribute("d", "M300,300 C300,400 400,400 400,300");
  b.setAttribute("stroke-width", "2px");
  b.setAttribute("fill", "none");
  b.setAttribute("stroke", "#ff0000");
  svg.appendChild(b);
  bez = b;
  
  line = [];
  for (let i = 0; i < 2; i++) {
    const b = createSVG("path");
    b.setAttribute("stroke-width", "1px");
    b.setAttribute("fill", "none");
    b.setAttribute("stroke", "#000000");
    svg.appendChild(b);
    line.push(b);
  }
  
  bez.draw = function() {
    const s = [];
    s.push("M");
    s.push(cp[0].getX());
    s.push(",");
    s.push(cp[0].getY());
    s.push(" C");
    for (let i = 1; i < 4; i++) {
      s.push(cp[i].getX());
      s.push(",");
      s.push(cp[i].getY());
      s.push(" ");
    }
    const d = s.join("");
    this.setAttribute("d", d);
    
    drawLine(line[0], cp[0], cp[1]);
    drawLine(line[1], cp[2], cp[3]);
  };
  bez.draw();
  
  main.appendChild(svg);
};
const getHit = (cp, x, y) => {
  let c = null;
  for (let i = 0; i < cp.length; i++) {
    if (cp[i].contains(x, y)) {
      return cp[i];
    }
  }
  return null;
};
const drawLine = (path, c1, c2) => {
  const s = [];
  s.push("M");
  s.push(c1.getX());
  s.push(",");
  s.push(c1.getY());
  s.push(" L");
  s.push(c2.getX());
  s.push(",");
  s.push(c2.getY());
  path.setAttribute("d", s.join(""));
};

</script>
<style>
body {
  font-family: sans-serif;
  text-align: center;
}
#svg {
  border: 1px solid black;
}
</style>
</head>
<body>

<div id="main"></div>

<div id="credit">
<img id="help">
<a href="http://fukuno.jig.jp/2012/">(c)taisukef CED</a>
</div>
<div id="helptips"><div id="helptipscontent">
ベジェ曲線の実験１<br>
<br>
拡大縮小しても滑らかに見える文字、これはベジェ曲線というもので描かれています。ベジェ曲線は視点と終点の他に、２点の制御点というものを使って、線の曲がり具合をコントロールしています。４つの点をいろいろ動かしてみてください。<br>
<br>
より詳しく知りたい方はこちらへ<br>
「<a href=http://ja.wikipedia.org/wiki/%E3%83%99%E3%82%B8%E3%82%A7%E6%9B%B2%E7%B7%9A target=_blank>ベジェ曲線 - Wikipedia</a>」
</div></div>

<div id="debug"></div>

</body>
</html>
